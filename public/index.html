<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aviador â€¢ Rota 3D</title>
<style>
body{margin:0; background:#05080d; font-family:sans-serif; color:#eee; overflow:hidden}
#hud{position:absolute; top:10px; left:10px; z-index:10; font-weight:bold; text-shadow:0 0 10px #000}
#hud span{font-size:28px; color:#7c3aed; text-shadow:0 0 20px #7c3aed,0 0 40px #06b6d4}
#status{display:block; margin-top:6px; font-size:14px; color:#ccc}
canvas{display:block}
</style>
</head>
<body>
<div id="hud">
  <span id="mult">1.00</span>x
  <div id="status">Esperandoâ€¦</div>
</div>
<canvas id="scene"></canvas>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
let scene,camera,renderer,plane,trailGeom,trailMat,trailLine;
let STATE={phase:"WAITING",multiplier:1,crashAt:5};
let mult=1, running=false, trailPts=[];
const canvas=document.getElementById("scene");
renderer=new THREE.WebGLRenderer({canvas,antialias:true,alpha:true});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth,window.innerHeight);
scene=new THREE.Scene();
camera=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,0.1,100);
camera.position.set(0,1.5,6);
const amb=new THREE.AmbientLight(0x99aaff,.7);
const dir=new THREE.DirectionalLight(0xffffff,1); dir.position.set(4,6,5);
scene.add(amb,dir);

// aviÃ£o menor e bonito
function buildPlane(){
  const mat1=new THREE.MeshStandardMaterial({color:0x7c3aed,metalness:.6,roughness:.3,emissive:0x220044,emissiveIntensity:.5});
  const mat2=new THREE.MeshStandardMaterial({color:0x06b6d4,emissive:0x003355,emissiveIntensity:.8});
  const fus=new THREE.Mesh(new THREE.CylinderGeometry(0.15,0.12,1.2,16),mat1);
  fus.rotation.z=Math.PI/2;
  const nose=new THREE.Mesh(new THREE.ConeGeometry(0.15,0.3,16),mat2);
  nose.position.set(0.65,0,0); nose.rotation.z=-Math.PI/2;
  const wing=new THREE.Mesh(new THREE.BoxGeometry(0.06,0.8,0.12),mat2);
  wing.position.set(0,0,-0.2);
  const wing2=wing.clone(); wing2.position.z=0.2;
  plane=new THREE.Group(); plane.add(fus,nose,wing,wing2);
  plane.scale.set(0.4,0.4,0.4); // menor
  scene.add(plane);
}
buildPlane();

// trilha (rota do aviÃ£o)
trailGeom=new THREE.BufferGeometry().setFromPoints([new THREE.Vector3()]);
trailMat=new THREE.LineBasicMaterial({color:0x06b6d4,linewidth:2});
trailLine=new THREE.Line(trailGeom,trailMat);
scene.add(trailLine);

// resize
window.addEventListener("resize",()=>{
  renderer.setSize(window.innerWidth,window.innerHeight);
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
});

// update posiÃ§Ã£o do aviÃ£o
function updatePlane(mult){
  const progress=(mult-1)/5; // cresce mais rÃ¡pido
  const x=-2+progress*6;
  const y=Math.sin(progress*3)*0.4+0.15*progress;
  plane.position.set(x,y,0);
  plane.rotation.z=Math.min(0.7,progress*1.2);
  // atualizar trilha
  trailPts.push(new THREE.Vector3(x,y,0));
  if(trailPts.length>200) trailPts.shift();
  trailGeom.setFromPoints(trailPts);
}

// crash
function planeCrash(){
  let v=-0.04;
  function fall(){
    if(STATE.phase!=="CRASHED") return;
    plane.position.y+=v; v-=0.004;
    plane.rotation.z+=0.1;
    if(plane.position.y>-3) requestAnimationFrame(fall);
  }
  fall();
}

// animaÃ§Ã£o
function animate(){
  requestAnimationFrame(animate);
  if(STATE.phase==="FLYING") updatePlane(STATE.multiplier);
  renderer.render(scene,camera);
}
animate();

// lÃ³gica da rodada
function startRound(){
  running=true; mult=1;
  STATE.phase="FLYING"; STATE.crashAt=2+Math.random()*8;
  document.getElementById("status").textContent="Em voo";
  const id=setInterval(()=>{
    mult*=1.08; // ðŸ”¹ mais rÃ¡pido
    STATE.multiplier=mult;
    document.getElementById("mult").textContent=mult.toFixed(2);
    if(mult>=STATE.crashAt){
      clearInterval(id);
      STATE.phase="CRASHED"; 
      document.getElementById("status").textContent="Crash "+STATE.crashAt.toFixed(2)+"x";
      planeCrash(); running=false;
      setTimeout(()=>{STATE.phase="WAITING";document.getElementById("status").textContent="Esperandoâ€¦";trailPts=[];},2000);
    }
  },160);
}
// loop de rounds automÃ¡ticos
setInterval(()=>{ if(!running && STATE.phase==="WAITING"){ startRound(); } },2000);
</script>
</body>
</html>
